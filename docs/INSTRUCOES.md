# Guia de Instala√ß√£o e Configura√ß√£o

## Pr√©-requisitos

- **Java 17** (LTS)
- **Maven 3.6+**
- **Node.js 16+** (para dashboard)
- **SQL Server** com JDBC Driver 13.2.0.jre11
- **Tokens de acesso ESL Cloud**

## üöÄ In√≠cio R√°pido com Scripts de Automa√ß√£o

### Scripts .bat Dispon√≠veis

Para facilitar o uso, utilize os scripts prontos na raiz do projeto:

```bash
# 1. Iniciar dashboard completo (backend + frontend)
01_iniciar_dashboard_completo.bat

# 2. Extrair dados das √∫ltimas 24 horas
02_extrair_dados_24h.bat

# 3. Extrair dados de uma data espec√≠fica
03_extrair_dados_por_data.bat

# 4. Testar APIs das √∫ltimas 24 horas
04_testar_api_24h.bat

# 5. Testar APIs de uma data espec√≠fica
05_testar_api_por_data.bat
```

### Vantagens dos Scripts
- ‚úÖ **Configura√ß√£o autom√°tica** de ambiente
- ‚úÖ **Compila√ß√£o autom√°tica** do projeto
- ‚úÖ **Execu√ß√£o padronizada** das opera√ß√µes
- ‚úÖ **Logs organizados** e f√°ceis de acompanhar
- ‚úÖ **Redu√ß√£o de erros** manuais

## Configura√ß√£o Manual (Avan√ßado)

### 1. Vari√°veis de Ambiente (Recomendado)

```powershell
# Windows PowerShell
$env:API_BASEURL="https://sua-empresa.eslcloud.com.br"
$env:API_REST_TOKEN="seu_token_rest"
$env:API_GRAPHQL_TOKEN="seu_token_graphql"
$env:API_GRAPHQL_ENDPOINT="/graphql"
$env:API_DATAEXPORT_TOKEN="seu_token_dataexport"
$env:DB_URL="jdbc:sqlserver://localhost:1433;databaseName=esl_cloud;encrypt=false;"
$env:DB_USER="sa"
$env:DB_PASSWORD="sua_senha"
```

```bash
# Linux/macOS
export API_BASEURL="https://sua-empresa.eslcloud.com.br"
export API_REST_TOKEN="seu_token_rest"
# ... demais vari√°veis
```

### 2. Arquivo de Configura√ß√£o (Alternativo)

Edite `src/main/resources/config.properties`:

```properties
api.baseurl=https://sua-empresa.eslcloud.com.br
api.rest.token=seu_token_rest
api.graphql.token=seu_token_graphql
api.graphql.endpoint=/graphql
api.dataexport.token=seu_token_dataexport
db.url=jdbc:sqlserver://localhost:1433;databaseName=esl_cloud;encrypt=false;
db.user=sa
db.password=sua_senha
```

## Compila√ß√£o e Execu√ß√£o

### M√©todo Recomendado: Scripts de Automa√ß√£o

**Use os scripts .bat** para opera√ß√µes padronizadas (veja se√ß√£o anterior).

### M√©todo Manual

#### 1. Compilar
```bash
mvn clean package
```

#### 2. Testar Configura√ß√£o
```bash
java -jar target/extrator-script.jar --validar
```

#### 3. Executar Dashboard
```bash
# Backend
java -jar target/extrator-esl-cloud-1.0-SNAPSHOT-dashboard.jar

# Frontend (novo terminal)
cd dashboard-monitoramento
npm install
$env:PORT=3001; npm start
```

#### 4. Executar Script
```bash
# √öltimas 24h
java -jar target/extrator-script.jar

# Data espec√≠fica
java -jar target/extrator-script.jar "2024-01-01T00:00:00"
```

## Requisitos T√©cnicos Atualizados

### Depend√™ncias Principais
- **Spring Boot 3.5.6** (suporte estendido at√© 2026)
- **Jackson** (com corre√ß√µes de deprecia√ß√£o)
- **SQL Server JDBC Driver 13.2.0.jre11**
- **React 18+** (frontend)

### Compatibilidade
- ‚úÖ **Java 17** (LTS) - melhor performance
- ‚úÖ **Spring Boot 3.x** - recursos modernos
- ‚úÖ **Windows/Linux/macOS** - multiplataforma

## Solu√ß√£o de Problemas

### Problemas Comuns e Solu√ß√µes

#### Erro de Conex√£o com Banco
- Verifique se o SQL Server est√° rodando
- Confirme as credenciais em `config.properties` ou vari√°veis de ambiente
- Teste a conectividade: `telnet localhost 1433`
- **Novo**: Verifique compatibilidade JDBC Driver 13.2.0.jre11 com Java 17

#### Erro de Token API
- Verifique se os tokens n√£o expiraram
- Confirme as URLs base das APIs
- Execute o teste: `java -jar target/extrator-script.jar --validar`
- **Use o script**: `04_testar_api_24h.bat` para valida√ß√£o r√°pida

#### Problemas de Compila√ß√£o
- **Java 17**: Certifique-se de usar Java 17 (n√£o 11 ou 8)
- **Spring Boot 3.5.6**: Verifique compatibilidade das depend√™ncias
- **M√©todos Depreciados**: J√° corrigidos (JsonNode.fields ‚Üí properties)

#### Porta em Uso
```bash
# Windows - encontrar processo na porta 7070
netstat -ano | findstr :7070
taskkill /PID [NUMERO_DO_PID] /F
```

#### Scripts .bat N√£o Funcionam
- Execute como Administrador se necess√°rio
- Verifique se Java 17 est√° no PATH
- Confirme se Maven est√° instalado e configurado
- Use `java -version` para verificar a vers√£o

### Logs e Monitoramento Aprimorado

- **Logs do Sistema**: `logs/extrator.log`
- **M√©tricas Autom√°ticas**: `metricas/metricas-YYYY-MM-DD.json`
- **Dashboard em Tempo Real**: http://localhost:3001
- **API Status**: http://localhost:7070/api/status
- **Taxa de Sucesso**: Objetivo 100% em todas as APIs
- **Performance**: Monitoramento de registros/segundo

## üîÑ Atualiza√ß√µes Recentes (2025)

### Melhorias Implementadas
- ‚úÖ **Upgrade para Spring Boot 3.5.6** (suporte at√© 2026)
- ‚úÖ **Migra√ß√£o para Java 17** (LTS, melhor performance)
- ‚úÖ **Corre√ß√£o de m√©todos depreciados** (Jackson)
- ‚úÖ **Scripts de automa√ß√£o** (.bat) para facilitar uso
- ‚úÖ **Limpeza de c√≥digo** (remo√ß√£o de m√©todos n√£o utilizados)
- ‚úÖ **M√©tricas aprimoradas** com coleta autom√°tica

### Benef√≠cios das Atualiza√ß√µes
- üöÄ **Performance melhorada** com Java 17
- üîí **Maior estabilidade** com Spring Boot 3.5.6
- üõ†Ô∏è **Facilidade de uso** com scripts automatizados
- üìä **Monitoramento aprimorado** com m√©tricas detalhadas
- üßπ **C√≥digo mais limpo** sem depend√™ncias desnecess√°rias

---

## Configura√ß√£o de Vari√°veis de Ambiente

### M√©todo Recomendado: Vari√°veis de Ambiente

Configure as seguintes vari√°veis no seu sistema:

```bash
# Windows (PowerShell)
$env:API_REST_TOKEN="seu_token_aqui"
$env:API_GRAPHQL_TOKEN="seu_token_aqui"
$env:API_GRAPHQL_ENDPOINT="/graphql"
$env:API_DATAEXPORT_TOKEN="seu_token_aqui"
$env:DB_URL="jdbc:sqlserver://localhost:1433;databaseName=esl_cloud;encrypt=false;"
$env:DB_USER="sa"
$env:DB_PASSWORD="SqlDocker!2025"
```

### M√©todo Alternativo: Arquivo config.properties

**Para desenvolvimento local**, voc√™ pode usar o arquivo `config.properties` localizado em `src/main/resources/config.properties`. Este arquivo serve como fallback quando as vari√°veis de ambiente n√£o est√£o configuradas.

Antes de executar o sistema, √© necess√°rio configurar o arquivo:

1. Abra o arquivo `config.properties` em um editor de texto
2. Configure os seguintes par√¢metros:

```properties
# Configura√ß√µes da API ESL Cloud
api.baseurl=https://rodogarcia.eslcloud.com.br

# API REST - Token do Usu√°rio do Sistema (Faturas e Ocorr√™ncias)
api.rest.token=_Rxcmz7vrmaGvYGy6VeyJxHNy5qHsToRGsPdqA88zgEs3aAFQ8ycxw

# API GraphQL - Token do Usu√°rio API (Coletas)
api.graphql.token=pGsc57wLxCHxTtbp8juDY3Q5BWpB2uurXB3-zoVkkDysMwf5taHqqw
api.graphql.endpoint=/graphql

# API Data Export - Token do Usu√°rio do Sistema (Manifestos e Localiza√ß√£o)
api.dataexport.token=_Rxcmz7vrmaGvYGy6VeyJxHNy5qHsToRGsPdqA88zgEs3aAFQ8ycxw

# Configura√ß√µes do Banco de Dados SQL Server Local
db.url=jdbc:sqlserver://localhost:1433;databaseName=esl_cloud;encrypt=false;
db.user=sa
db.password=SqlDocker!2025
```

## Execu√ß√£o do Sistema

### M√©todo 1: Usando o JAR compilado

1. Abra o prompt de comando (CMD) ou PowerShell
2. Navegue at√© a pasta do projeto:
   ```
## Logs e Monitoramento

- **Logs do Sistema**: `logs/extrator.log`
- **M√©tricas**: `metricas/metricas-YYYY-MM-DD.json`
- **Dashboard**: http://localhost:3001
- **API Status**: http://localhost:7070/api/status

## Estrutura do Projeto Atualizada

```
script-automacao/
‚îú‚îÄ‚îÄ README.md                    # Guia principal
‚îú‚îÄ‚îÄ pom.xml                      # Configura√ß√£o Maven (Spring Boot 3.5.6)
‚îú‚îÄ‚îÄ docs/                        # Documenta√ß√£o t√©cnica
‚îÇ   ‚îú‚îÄ‚îÄ README.md               # Vis√£o t√©cnica
‚îÇ   ‚îú‚îÄ‚îÄ INSTRUCOES.md          # Este arquivo
‚îÇ   ‚îî‚îÄ‚îÄ ARQUITETURA-TECNICA.md # Detalhes t√©cnicos
‚îú‚îÄ‚îÄ dashboard-monitoramento/     # Frontend React 18+
‚îú‚îÄ‚îÄ src/main/                   # C√≥digo fonte Java 17
‚îú‚îÄ‚îÄ logs/                       # Logs de execu√ß√£o
‚îú‚îÄ‚îÄ metricas/                   # M√©tricas JSON autom√°ticas
‚îú‚îÄ‚îÄ *.bat                       # Scripts de automa√ß√£o (5 arquivos)
‚îî‚îÄ‚îÄ target/                     # Artefatos compilados
```

## Suporte e Troubleshooting

### Recursos de Ajuda
- üìñ **Documenta√ß√£o**: Consulte `docs/ARQUITETURA-TECNICA.md`
- üîß **Scripts de Teste**: Use `04_testar_api_24h.bat`
- üìä **Dashboard**: Monitore em tempo real via http://localhost:3001
- üìù **Logs Detalhados**: Verifique `logs/extrator.log`

### Contato e Suporte
- **Logs de Erro**: Sempre em `logs/extrator.log`
- **M√©tricas**: Arquivos JSON em `metricas/`
- **Status APIs**: http://localhost:7070/api/status
- **Performance**: Monitoramento cont√≠nuo de registros/segundo

---

*Documenta√ß√£o atualizada para Spring Boot 3.5.6 e Java 17 - Janeiro 2025*