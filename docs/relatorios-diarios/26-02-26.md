# Relatorio Diario de Desenvolvimento
**Projeto:** Extrator de Dados ESL Cloud (ETL)  
**Data:** 26/02/2026  
**Status:** Concluido com Sucesso

---

## Resumo Executivo

Foi concluido o levantamento tecnico da nova tabela no DataExport, referente ao relatorio **"Tabelas de Frete Cadastradas"**, com foco em integracao para chatbot/API.

Resultado final:
- template localizado e validado em API
- endpoints mapeados (lista, schema e dados)
- filtros e campos reais identificados
- payloads de consulta validados (ativo e por nome)
- comportamento de paginacao e limite de requisicao documentado

---

## Descoberta da Tabela no DataExport

Template identificado:
- `id`: `4813`
- `name`: `Tabelas de Frete Cadastradas`
- `root`: `customer_price_table`

Esse template nao estava no codigo local e foi confirmado via requisicoes diretas na API do DataExport.

---

## Endpoints Validados

1. Listagem de relatorios/templates:
- `GET /api/analytics/reports`

2. Metadados do relatorio (filtros, colunas, colecoes):
- `GET /api/analytics/reports/4813/info`

3. Dados paginados do relatorio:
- `GET /api/analytics/reports/4813/data`
- uso observado com corpo JSON (filtros, pagina e tamanho)

---

## Filtros Identificados no /info

Filtros disponiveis para consulta:
- `name`
- `type`
- `created_at`
- `active`
- `price_table_service_type`

Mapeamento pratico para o pedido:
- somente ativas: `active = true`
- recorte por tipo de servico: `price_table_service_type` (quando populado)

---

## Campos Retornados (Dados Reais)

Campos efetivamente encontrados no retorno:
- `cre_pis_psn_document` (CNPJ/CPF)
- `cre_pis_psn_name` (Cliente/Nome)
- `name` (Nome da tabela)
- `range_type` (Faixa principal: ex. `taxed_weight`)
- `effective_since` (Valida de)
- `effective_until` (Valida ate)
- `built_in_tax` (Imposto embutido)
- `active` (Ativa)
- `cre_pis_is_default` (Clientes/Padrao)

Observacao importante:
- o dataset vem no nivel tabela x cliente (mesma tabela pode repetir para multiplos documentos/clientes).

---

## Payloads Validados

### 1. Consulta de tabelas ativas

```json
{
  "filters": [
    { "name": "active", "value": true }
  ],
  "page": 1,
  "per": 200
}
```

### 2. Consulta por nome da tabela (exemplo EVONIK)

```json
{
  "filters": [
    { "name": "name", "value": "EVONIK - FRACIONADA" }
  ],
  "page": 1,
  "per": 200
}
```

### 3. Exemplo de linha retornada

```json
{
  "name": "EVONIK - FRACIONADA",
  "range_type": "taxed_weight",
  "effective_since": "2023-05-01",
  "effective_until": "2026-03-31",
  "built_in_tax": false,
  "active": true,
  "cre_pis_is_default": true,
  "cre_pis_psn_document": "62695036003703",
  "cre_pis_psn_name": "EVONIK BRASIL LTDA"
}
```

---

## Comportamento Observado em Coleta

- rate limit: API retornou `Retry later` em sequencia agressiva
- recomendacao pratica: intervalo de ~2s entre chamadas
- paginacao nao linear: paginas com volumes variaveis e paginas vazias apos limite real
- consolidacao em varredura ampliada:
  - `RAW_TOTAL_ROWS`: `4129`
  - `UNIQUE_ROWS`: `3427`
  - `DUPLICATE_ROWS`: `702`

---

## Mapeamento para Chatbot/API

Estrutura minima recomendada para consumo:

```json
{
  "cliente_documento": "62695036003703",
  "cliente_nome": "EVONIK BRASIL LTDA",
  "tabela": "EVONIK - FRACIONADA",
  "faixa_principal": "taxed_weight",
  "valida_de": "2023-05-01",
  "valida_ate": "2026-03-31",
  "imposto_embutido": false,
  "ativa": true,
  "cliente_padrao": true
}
```

---

## Conclusao

O novo relatorio do DataExport foi identificado e mapeado tecnicamente com sucesso, incluindo template, endpoints, filtros, campos e payloads operacionais para integracao.

Data/hora de consolidacao: **2026-02-26 -03:00**
