# Relatório de Diagnóstico e Correção da Extração de Dados  
**Data:** 07/10/2025  
**Projeto:** Automação da Extração de Dados para BI  
**Assunto:** Validação das APIs GraphQL e REST  

---

## 1. Contexto
Diagnóstico e correção de erros no script de extração de dados do sistema ESL Cloud, garantindo o funcionamento das APIs de **Coletas, Fretes, Faturas, Ocorrências, Manifestos e Localização** no ambiente de teste.

---

## 2. Resumo Executivo
Foram corrigidos erros de **configuração, compilação, lógica e tipagem de dados**.  
As APIs **GraphQL (Coletas e Fretes)** e **REST (Faturas e Ocorrências)** estão funcionando corretamente.  

**Pendente:** API **Data Export** ainda apresenta **erro 404 Not Found** ao solicitar relatórios.

---

## 3. Diagnóstico e Soluções

### ✅ Problema 1 – Lógica de Data (GraphQL - Fretes)
**Sintoma:** Nenhum registro retornado.  
**Causa:** Intervalo de data incorreto ("2025-10-06 - 2025-10-06").  
**Solução:** Gerar intervalo dinâmico de **48 horas** ("2025-10-05 - 2025-10-06").

---

### ✅ Problema 2 – Erros de Execução e Configuração
**Sintoma:** Falhas com `ConnectException`, `NoClassDefFoundError` e `NumberFormatException`.  
**Causas:**  
- URL base incorreta no arquivo de configuração.  
- Execução sem dependências do classpath.  
- `api.corporation.id` em arquivo errado.  

**Solução:**  
Consolidar tudo em **config.properties** e executar com `mvn exec:java`.

---

### ✅ Problema 3 – Truncamento de Dados no SQL
**Sintoma:** Erro `String or binary data would be truncated`.  
**Causa:** Campos JSON salvos em `VARCHAR(255)`.  
**Solução:** Detectar JSON e criar coluna como **`VARCHAR(MAX)`** na classe `GeradorTabelasDinamico.java`.

---

### ❌ Problema 4 – Erro na API Data Export (Pendente)
**Sintoma:** `404 Not Found` ao solicitar relatórios.  
**Causa provável:**  
- API requer **ID numérico** em vez do **nome do template**.  
- Token sem permissão para o template.  

**Status:** Pendente.

---

## 4. Próximos Passos
- Refatorar `ClienteApiDataExport.java`.  
- Listar templates via endpoint e usar o **ID numérico** para solicitar relatórios de:
  - **Manifestos**
  - **Localização da Carga**
