# ==============================================================================
# CONFIGURACOES GERAIS DA API
# ==============================================================================
# URL base para todas as APIs (REST, DataExport, GraphQL)
# Pode ser sobrescrita pela variavel de ambiente API_BASEURL
api.baseurl=https://rodogarcia.eslcloud.com.br

# Configuracoes da API REST
# NOTA: api.rest.base.url e api.rest.token devem ser definidos via variaveis de ambiente
# Exemplo: API_REST_BASE_URL=https://rodogarcia.eslcloud.com.br
# Exemplo: API_REST_TOKEN=seu_token_aqui

# Endpoint especifico para a API GraphQL
# Pode ser sobrescrito pela variavel de ambiente API_GRAPHQL_ENDPOINT
api.graphql.endpoint=/graphql

# ID da corporacao, usado principalmente em queries GraphQL
api.corporation.id=385129

# Timeout geral para cada requisicao HTTP em segundos
api.rest.timeout.seconds=120

# ==============================================================================
# CONFIGURACOES DE CONTROLE DE FLUXO (THROTTLING & RETRY)
# Regras globais para garantir a estabilidade da integracao com a ESL Cloud
# ==============================================================================

# [CONTROLE DE RATE LIMIT] Intervalo minimo OBRIGATORIO entre TODAS as requisicoes HTTP.
# A API da ESL Cloud tem um limite de requisicoes por minuto. Um valor seguro para evitar
# o erro HTTP 429 e de 2200ms (2.2 segundos), dando uma margem de seguranca.
api.throttling.intervalo_entre_requisicoes_ms=2200

# [PAUSA ESTRATEGICA] Intervalo de espera em milissegundos ENTRE a extracao de
# DIFERENTES entidades (ex: apos buscar todas as Faturas e antes de buscar Ocorrencias).
# Isso ajuda a "resetar" a janela de rate limit do servidor.
api.throttling.intervalo_entre_processos_ms=3000

# [TENTATIVAS DE ERRO] Numero maximo de tentativas para uma requisicao que falhou.
api.retry.max_tentativas=5

# [DELAY INICIAL] Tempo base de espera (em milissegundos) antes da primeira tentativa.
api.retry.delay_base_ms=2000

# [BACKOFF EXPONENCIAL] Multiplicador para aumentar o tempo de espera a cada nova tentativa.
# Ex: 2s, 4s, 8s...
api.retry.multiplicador=2.0

# ==============================================================================
# CONFIGURACOES DA API DATA EXPORT
# IDs dos templates de relatorio, validados via Postman.
# ==============================================================================
api.dataexport.template.manifestos=6399
api.dataexport.template.localizacao=8656
api.dataexport.template.cotacoes=6906

# ==============================================================================
# CONFIGURACOES DE PAGINACAO E LIMITES
# Adicionado em 03/11/2025 - Correcao de warnings de configuracao
# ==============================================================================

# Limite maximo de paginas para API REST
# Evita loops infinitos em caso de problemas na API
# Valor padrao: 500 paginas (suficiente para ~10.000 registros com per_page=20)
api.rest.max.paginas=500

# Limite maximo de paginas para API GraphQL
# Evita loops infinitos em caso de problemas na API
# Valor padrao: 2000 paginas (suficiente para ~40.000 registros com 20 por pagina)
api.graphql.max.paginas=2000

# Limite maximo de REGISTROS por execucao (protecao contra loops infinitos)
# PROBLEMA #7 CORRIGIDO: Valores agora configuraveis em vez de hardcoded
api.graphql.max.registros.execucao=50000
api.dataexport.max.registros.execucao=10000
api.graphql.faturas.dias_janela=2
api.graphql.faturas.max_paginas=200

# Limite maximo de paginas para API DataExport
# Evita loops infinitos em caso de problemas na API
# Valor padrao: 500 paginas (suficiente para relatorios grandes)
api.dataexport.max.paginas=500

# Intervalo minimo entre requisicoes HTTP (alias para compatibilidade com codigo)
# NOTA: Este e um alias para api.throttling.intervalo_entre_requisicoes_ms
# Mantido para compatibilidade com o CarregadorConfig.java que busca por este nome
api.throttling.minimo_ms=2200

# ==============================================================================
# FASE 4: CONFIGURACOES DE ENRIQUECIMENTO DE FATURAS GRAPHQL
# Otimizacao de performance com padrao Producer-Consumer
# ==============================================================================

# Numero de threads para processamento PARALELO de resultados (NAO para requisicoes HTTP)
# As requisicoes HTTP continuam SEQUENCIAIS com intervalo de 2s (throttling global)
# Essas threads sao usadas para: parsing de JSON, mapeamento de entidades, salvamento no banco
# Valor padrao: 5 threads (ajustar baseado em recursos do servidor)
api.enriquecimento.faturas.threads=5

# Limite de erros CONSECUTIVOS antes de aumentar delay entre requisicoes
# Se houver mais de N erros seguidos, o sistema aumenta o delay para dar tempo ao servidor
api.enriquecimento.erros_consecutivos_limite=10

# Multiplicador de delay quando ha muitos erros consecutivos
# Ex: 2.0 = dobra o delay de 2s para 4s quando atingir o limite de erros
api.enriquecimento.delay_multiplier_erros=2.0

# Intervalo (em numero de faturas) para log de progresso detalhado
# A cada N faturas processadas, mostra: % concluido, taxa, tempo estimado
api.enriquecimento.intervalo_log_progresso=100

# Intervalo (em segundos) para heartbeat durante o enriquecimento
# Mesmo sem novos registros, mostra que o processo esta vivo
api.enriquecimento.heartbeat_segundos=10

# ==============================================================================
# TOLERANCIAS OPERACIONAIS ETL (ANTI-RUIDO DE ORIGEM)
# ==============================================================================
# Registros invalidos descartados por entidade (DataExport): se estiverem dentro
# desses limites (quantidade E percentual), o status da entidade permanece COMPLETO
# com motivo INVALIDOS_TOLERADOS.
etl.invalidos.quantidade.max=500
etl.invalidos.percentual.max=2.5

# Integridade referencial manifestos -> coletas: se orfaos estiverem dentro
# desses limites (quantidade E percentual), vira ALERTA nao-bloqueante.
etl.referencial.manifestos.orfaos.quantidade.max=500
etl.referencial.manifestos.orfaos.percentual.max=35.0

# Backfill preventivo de coletas para reduzir risco de orfaos de manifestos
# em bases recem-limpas antes da validacao estrita.
# Exemplo: janela padrao [D-1, D] e valor=1 => preenche dia D-2.
# Em producao, 5 dias reduz fortemente orfaos quando PickInput so aceita requestDate.
etl.referencial.coletas.backfill.dias=5

# ==============================================================================
# CONFIGURACOES DE BANCO (Opcional - usar apenas em desenvolvimento)
# Se variaveis de ambiente nao estiverem definidas, o sistema buscara aqui.
# NUNCA comitar segredos reais.
# ==============================================================================
# Variaveis de ambiente recomendadas (padroes do codigo):
# DB_BATCH_SIZE=100
# EXTRACAO_DELAY_MS=2000
# DB_POOL_MAX_SIZE=10
# DB_POOL_MIN_IDLE=2
# DB_POOL_IDLE_TIMEOUT=600000
# DB_POOL_CONN_TIMEOUT=30000
# DB_POOL_MAX_LIFETIME=1800000
#
# Alternativa via config.properties (mesmos valores):
# db.batch.size=100
# extracao.delay.ms=2000
# db.pool.maximum_size=10
# db.pool.minimum_idle=2
# db.pool.idle_timeout_ms=600000
# db.pool.connection_timeout_ms=30000
# db.pool.max_lifetime_ms=1800000
extracao.delay.ms=2000
db.pool.minimum_idle=2
# Credenciais de banco devem ser definidas apenas via ambiente:
# DB_URL, DB_USER, DB_PASSWORD

# ==============================================================================
# LOOP DAEMON: RECONCILIACAO AUTOMATICA
# ==============================================================================
# Executa reconciliacao automatica apos cada ciclo para reduzir risco de lacunas.
# Pode ser sobrescrito via variavel de ambiente LOOP_RECONCILIACAO_ATIVA.
loop.reconciliacao.ativa=true

# Quantidade maxima de reconciliacoes pendentes executadas por ciclo do daemon.
# Pode ser sobrescrito via LOOP_RECONCILIACAO_MAX_POR_CICLO.
loop.reconciliacao.max_por_ciclo=2

# Em caso de falha do ciclo principal, adiciona dias retroativos como pendentes.
# Exemplo: 1 = dia do ciclo + dia anterior.
# Pode ser sobrescrito via LOOP_RECONCILIACAO_DIAS_RETROATIVOS_FALHA.
loop.reconciliacao.dias_retroativos_falha=1



