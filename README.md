# Extrator de Dados ESL Cloud

Script de automa√ß√£o em Java que extrai dados de m√∫ltiplas APIs do ESL Cloud e carrega em SQL Server, com coleta autom√°tica de m√©tricas de execu√ß√£o.

## üöÄ In√≠cio R√°pido

### Scripts de Automa√ß√£o (.bat)
Para facilitar o uso e executar cada API de forma independente:

```bash
# Testar API REST (Faturas e Ocorr√™ncias)
testar_api_rest.bat

# Testar API GraphQL (Coletas e Fretes)
testar_api_graphql.bat

# Testar API Data Export (Manifestos, Cota√ß√µes, Localiza√ß√£o da Carga)
testar_api_dataexport.bat
```

### Execu√ß√£o Manual

#### 1. Compilar o Projeto
```bash
mvn clean package
```

#### 2. Executar Script de Extra√ß√£o
```bash
# Executar uma API espec√≠fica (janela padr√£o: √∫ltimas 24 horas)
java -jar target/extrator-script.jar --testar-api rest
java -jar target/extrator-script.jar --testar-api graphql
java -jar target/extrator-script.jar --testar-api dataexport
```

## üìã Funcionalidades

- **3 APIs Integradas**: REST, GraphQL e Data Export
- **Script de Linha de Comando**: Execu√ß√£o √∫nica para extra√ß√£o de dados
- **Scripts de Automa√ß√£o**: 4 scripts .bat para facilitar opera√ß√µes
- **Preven√ß√£o de Duplicatas**: Sistema MERGE para evitar dados duplicados
- **Logs Detalhados**: Acompanhamento completo das opera√ß√µes
- **M√©tricas Autom√°ticas**: Coleta de performance e estat√≠sticas salvas em JSON
- **Valida√ß√£o de APIs**: Teste de conectividade sem executar extra√ß√£o
- **Introspec√ß√£o GraphQL**: Descoberta de tipos e campos dispon√≠veis

## ‚öôÔ∏è Configura√ß√£o

Configure as vari√°veis de ambiente ou edite `src/main/resources/config.properties`:

```bash
# Vari√°veis de Ambiente (Recomendado)
$env:API_BASEURL="https://sua-empresa.eslcloud.com.br"
$env:API_REST_TOKEN="seu_token_rest"
$env:API_GRAPHQL_TOKEN="seu_token_graphql"
$env:API_DATAEXPORT_TOKEN="seu_token_dataexport"
$env:DB_URL="jdbc:sqlserver://localhost:1433;databaseName=esl_cloud"
$env:DB_USER="sa"
$env:DB_PASSWORD="sua_senha"
```

## üèóÔ∏è Arquitetura

### APIs Suportadas
- **API REST**: Faturas e Ocorr√™ncias
- **API GraphQL**: Coletas e Fretes  
- **API Data Export**: Manifestos e Localiza√ß√£o da Carga

### Componentes
- **Runners Independentes** (`runners/*.java`): Execu√ß√£o desacoplada por API
- **Script de Entrada** (`Main.java`): Apenas despacha por `--testar-api`
- **Servi√ßos de Logging** (`LoggingService.java`): Sistema de logs estruturados
- **Clientes de API**: Integra√ß√£o com REST, GraphQL e Data Export

## üìö Documenta√ß√£o

- **[Guia de Instala√ß√£o](docs/INSTRUCOES.md)**: Configura√ß√£o detalhada
- **[Arquitetura T√©cnica](docs/ARQUITETURA-TECNICA.md)**: Detalhes t√©cnicos
## üìä Monitoramento e Logs

- **Sistema de Auditoria**: Valida√ß√£o autom√°tica de integridade de dados
- **Logs Estruturados**: Rastreamento detalhado de execu√ß√µes
- **Relat√≥rios**: Gera√ß√£o autom√°tica de relat√≥rios de execu√ß√£o

### Documenta√ß√£o T√©cnica

- **Auditoria**: `docs/auditoria/` - Valida√ß√£o de integridade de dados
- **Configura√ß√£o**: `docs/configuracao/` - Guias de setup e configura√ß√£o
- **Desenvolvimento**: `docs/desenvolvimento/` - Padr√µes e pr√°ticas de c√≥digo

## üîß Requisitos T√©cnicos

- **Java 17** (LTS)
- **Maven 3.6+**
- **SQL Server** com JDBC Driver 13.2.0.jre11
- **Acesso √†s APIs ESL Cloud**

### Depend√™ncias Principais
- Jackson (processamento JSON)
- SQL Server JDBC Driver 13.2.0.jre11
- SLF4J (logging)

## üìä M√©tricas e Monitoramento

O sistema gera m√©tricas autom√°ticas em `metricas/metricas-YYYY-MM-DD.json` com:
- Tempos de execu√ß√£o por API
- Quantidade de registros processados
- Taxa de sucesso/falha (objetivo: 100%)
- Performance geral (registros/segundo)
- Hist√≥rico de execu√ß√µes

## üÜò Suporte e Troubleshooting

Para problemas ou d√∫vidas:
1. **Verifique os logs** em `logs/`
2. **Consulte a documenta√ß√£o** em `docs/`
3. **Execute o teste de valida√ß√£o**: `java -jar target/extrator-script.jar --validar`
4. **Use os scripts .bat** para opera√ß√µes padronizadas
5. **Monitore as m√©tricas** para identificar problemas de performance

## üîÑ Atualiza√ß√µes Recentes

- ‚úÖ **Refatora√ß√£o para Script de Linha de Comando** (remo√ß√£o do dashboard web)
- ‚úÖ **Remo√ß√£o de depend√™ncias web** (Spring Boot Web, Actuator)
- ‚úÖ **Otimiza√ß√£o do JAR final** (redu√ß√£o significativa do tamanho)
- ‚úÖ **M√©tricas aprimoradas** com salvamento autom√°tico em JSON
- ‚úÖ **Scripts de automa√ß√£o** (.bat) para facilitar opera√ß√µes
- ‚úÖ **Valida√ß√£o e introspec√ß√£o** de APIs integradas