# Extrator de Dados ESL Cloud

Sistema de automa√ß√£o em Java que extrai dados de m√∫ltiplas APIs do ESL Cloud e carrega em SQL Server, com dashboard de monitoramento em tempo real.

## üöÄ In√≠cio R√°pido

### Scripts de Automa√ß√£o (.bat)
Para facilitar o uso, utilize os scripts prontos:

```bash
# 1. Iniciar dashboard completo (backend + frontend)
01_iniciar_dashboard_completo.bat

# 2. Extrair dados das √∫ltimas 24 horas
02_extrair_dados_24h.bat

# 3. Extrair dados de uma data espec√≠fica
03_extrair_dados_por_data.bat

# 4. Testar APIs das √∫ltimas 24 horas
04_testar_api_24h.bat

# 5. Testar APIs de uma data espec√≠fica
05_testar_api_por_data.bat
```

### Execu√ß√£o Manual

#### 1. Compilar o Projeto
```bash
mvn clean package
```

#### 2. Executar o Dashboard (Servidor Web)
```bash
# Iniciar backend na porta 7070
java -jar target/extrator-esl-cloud-1.0-SNAPSHOT-dashboard.jar

# Em outro terminal, iniciar frontend na porta 3001
cd dashboard-monitoramento
npm install
$env:PORT=3001; npm start
```

**Acesse:** http://localhost:3001

#### 3. Executar Script de Extra√ß√£o
```bash
# Extrair dados das √∫ltimas 24 horas
java -jar target/extrator-script.jar

# Extrair dados de uma data espec√≠fica
java -jar target/extrator-script.jar "2024-01-01T00:00:00"
```

## üìã Funcionalidades

- **3 APIs Integradas**: REST, GraphQL e Data Export
- **Dashboard em Tempo Real**: Monitoramento visual das extra√ß√µes
- **Scripts de Automa√ß√£o**: 5 scripts .bat para facilitar opera√ß√µes
- **Dois Execut√°veis**: Servidor web e script de linha de comando
- **Preven√ß√£o de Duplicatas**: Sistema MERGE para evitar dados duplicados
- **Logs Detalhados**: Acompanhamento completo das opera√ß√µes
- **M√©tricas Autom√°ticas**: Coleta de performance e estat√≠sticas

## ‚öôÔ∏è Configura√ß√£o

### üîê Configura√ß√£o Segura

**‚ö†Ô∏è IMPORTANTE:** Nunca inclua tokens, senhas ou dados sens√≠veis diretamente no c√≥digo ou documenta√ß√£o.

**Para obter as configura√ß√µes reais:**
- Consulte o diret√≥rio `docs/arquivos-secretos-gitignore/`
- Este diret√≥rio est√° protegido pelo `.gitignore` e cont√©m os dados sens√≠veis

### M√©todo 1: Vari√°veis de Ambiente (Recomendado)

```bash
# Windows PowerShell
$env:API_BASEURL="https://sua-empresa.eslcloud.com.br"
$env:API_REST_TOKEN="seu_token_rest"
$env:API_GRAPHQL_TOKEN="seu_token_graphql"
$env:API_DATAEXPORT_TOKEN="seu_token_dataexport"
$env:DB_URL="jdbc:sqlserver://localhost:1433;databaseName=esl_cloud"
$env:DB_USER="sa"
$env:DB_PASSWORD="sua_senha_segura"
```

### M√©todo 2: Arquivo config.properties

Edite `src/main/resources/config.properties` com valores gen√©ricos:

```properties
api.baseurl=https://sua-empresa.eslcloud.com.br
api.rest.token=SEU_TOKEN_REST_AQUI
api.graphql.token=SEU_TOKEN_GRAPHQL_AQUI
api.dataexport.token=SEU_TOKEN_DATAEXPORT_AQUI
db.url=jdbc:sqlserver://localhost:1433;databaseName=esl_cloud
db.user=sa
db.password=SUA_SENHA_SEGURA
```

**üìÅ Valores reais:** Dispon√≠veis em `docs/arquivos-secretos-gitignore/`

## üèóÔ∏è Arquitetura

### APIs Suportadas
- **API REST**: Faturas e Ocorr√™ncias
- **API GraphQL**: Coletas e Fretes  
- **API Data Export**: Manifestos e Localiza√ß√£o da Carga

### Componentes
- **Script de Extra√ß√£o** (`Main.java`): Execu√ß√£o √∫nica para extrair dados
- **Servidor Dashboard** (`WebApplication.java`): API REST + interface web
- **Frontend React**: Dashboard de monitoramento visual

## üìö Documenta√ß√£o

- **[Guia de Instala√ß√£o](docs/INSTRUCOES.md)**: Configura√ß√£o detalhada
- **[Arquitetura T√©cnica](docs/ARQUITETURA-TECNICA.md)**: Detalhes t√©cnicos
- **[Dashboard](dashboard-monitoramento/COMO-INICIAR.md)**: Instru√ß√µes do frontend

## üîß Requisitos T√©cnicos

- **Java 17** (LTS)
- **Spring Boot 3.5.6**
- **Maven 3.6+**
- **Node.js 16+** (para o dashboard)
- **SQL Server** com JDBC Driver 13.2.0.jre11
- **Acesso √†s APIs ESL Cloud**

### Depend√™ncias Principais
- Spring Boot 3.5.6
- Jackson (com corre√ß√µes de deprecia√ß√£o)
- SQL Server JDBC Driver 13.2.0.jre11
- React 18+ (frontend)

## üìä M√©tricas e Monitoramento

O sistema gera m√©tricas autom√°ticas em `metricas/metricas-YYYY-MM-DD.json` com:
- Tempos de execu√ß√£o por API
- Quantidade de registros processados
- Taxa de sucesso/falha (objetivo: 100%)
- Performance geral (registros/segundo)
- Hist√≥rico de execu√ß√µes

## üÜò Suporte e Troubleshooting

Para problemas ou d√∫vidas:
1. **Verifique os logs** em `logs/`
2. **Consulte a documenta√ß√£o** em `docs/`
3. **Execute o teste de valida√ß√£o**: `java -jar target/extrator-script.jar --validar`
4. **Use os scripts .bat** para opera√ß√µes padronizadas
5. **Monitore as m√©tricas** para identificar problemas de performance

## üîÑ Atualiza√ß√µes Recentes

- ‚úÖ **Upgrade para Spring Boot 3.5.6** (compat√≠vel com Java 17)
- ‚úÖ **Corre√ß√£o de m√©todos depreciados** (Jackson JsonNode.fields ‚Üí properties)
- ‚úÖ **Remo√ß√£o de c√≥digo n√£o utilizado** (limpeza t√©cnica)
- ‚úÖ **Scripts de automa√ß√£o** (.bat) para facilitar opera√ß√µes
- ‚úÖ **M√©tricas aprimoradas** com coleta autom√°tica de performance